# 產品需求文件（PRD）— 永豐 API 自動交易程式（Cloud Run）

## 1. 背景與目標

* **背景**：以永豐金證券 API 建置自動交易程式，盤中即時訂閱市場資料（上漲排行前 100 名之股票之 TICK），依策略條件自動下單。
* **主要目標**

  1. 成功透過 API **登入**並維持權杖有效。
  2. 盤中**訂閱上漲排行 Top 100** 之所有股票的 **TICK**（逐筆成交/委託變化）資料。
  3. 觸發條件「**當日累積成交量 > 1000 張** 且 **當日漲幅 ≥ 6%**」即 **買進**。
  4. 系統以 **Google Cloud Run** 雲端化部署，具備觀測性、可回復性與安全性。

## 2. 範圍與非範圍

* **在範圍**

  * 單一策略：成交量與漲幅同時達標則買進。
  * 單邏輯方向：僅做**買進**（賣出邏輯不在本版 PRD）。
  * 交易市場：台股集中市場**整股**常規時段。
  * 雲端部署：Cloud Run。

## 3. 名詞與定義

* **TICK**：逐筆成交或委託資料之即時更新事件。
* **上漲排行 Top 100**：依當日漲幅排序之前 100 檔股票清單（以永豐或交易所資料源為準）。
* **當日漲幅**： $(最新成交價 − 昨收) / 昨收$ × 100%。
* **當日成交量（張）**：當日累積成交股數 / 1000（台股 1 張 = 1000 股）。
* **交易時段**：常規盤 09:00–13:30（台北時間）。預撮合 08:30–09:00 不交易。

## 4. 使用者故事

1. **系統操作者**：我希望服務自動於開盤前啟動、登入並訂閱標的，盤中符合策略自動下單，並於收盤後安全關閉連線與產出日誌。
2. **風控/維運**：我需要在異常（連線中斷、下單失敗、超額下單嘗試）時，能在 1 分鐘內收到告警，並可從日誌追溯。
3. **開發/測試**：我需要\*\*模擬/乾跑模式（dry-run）\*\*以驗證策略觸發與風控。
